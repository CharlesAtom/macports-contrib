<% controller.set_chart_title :version_count, 'All Versions' %>
<% controller.set_chart_type :version_count, 'PieChart' %>

<% controller.set_chart_title :variant_count, 'All Variants' %>
<% controller.set_chart_type :variant_count, 'PieChart' %>

<% controller.set_chart_title :versions_over_time, 'Top Versions in use Over Last 12 Months' %>
<% controller.set_chart_type :versions_over_time, 'LineChart' %>

<% controller.set_chart_title :installs_over_time, 'Installations Over Last 12 Months' %>
<% controller.set_chart_type :installs_over_time, 'LineChart' %>

<%# Order the charts %>
<% ordered_charts = [:installs_over_time, 
                     :versions_over_time, 
                     :version_count, 
                     :variant_count] %>

<h1> <%= @port.name %> </h1>

<br />

<div id="content">
  <p>
    <strong>Current Version:</strong> <%= @port.version %>
  </p>

  <% unless @port.description.nil? %>
    <p>
      <strong>Description:</strong> <%= @port.description %>
    </p>
  <% end %>

  <% unless @port.licenses.nil? %>
    <p>
      <strong>Licenses:</strong> <%= @port.licenses %>
    </p>
  <% end %>

  <p>
    <strong>Categories</strong>
    <%=h @port.categories %>
  </p>

  <% unless @port.variants.nil? %>
    <p>
      <strong>Variants:</strong> <%=h @port.variants %>
    </p>
  <% end %>

  </div>
  
  <br />
  
  <h2> Stats </h2>

  <%# Generate links %>
  <ul>
  <% ordered_charts.each do |chart|  %>
  <li> <%= link_to controller.chart_title(chart), :anchor => chart %> </li>
  <% end %>
  </ul>

  <br />

  <%# Draw charts %>
  <% ordered_charts.each do |chart| %>
    <% title = controller.chart_title chart %>
    <%# Set visualization options %>
    <% vis_options = {:width => 600, :height => 400, :html => {:class => "graph_chart"}} %>
    <% vis_options[:title] = title %>

    <%# Set table options %>
    <% table_options = {:width => 600, :html => {:class => "graph_chart"}} %>
    <% table_options[:title] = title %>
    
    <% type = controller.chart_type chart %>

    <%# Anchor %>
    <a name=<%= chart %>> </a>
    <%# Title %>
    <h2> <%= title %> </h2>
   
  
    <% if not controller.dataset_empty? chart %>
      <%# Draw visualization %>
      <% visualization chart, type, vis_options do |visualization| %>
        <% controller.populate_chart chart, visualization %>
      <% end %>
      
      <%# Draw table %>
      <% table = chart.to_s + "_table" %>
      <% visualization table, "Table", table_options do |visualization| %>
        <% controller.populate_chart chart, visualization %>
      <% end %>
      
    <% else %>
      No data to display
    <% end %>  
  <% end %>

  <table border=1>
    <tr>
      <th> ID </th>
      <th> port_id </th>
      <th> version </th>
      <th> variants </th>
      <th> modified_date </th>
    </tr>

  <% @installed.each do |row| %>
    <tr>
      <td> <%= row.id %> </td>
      <td> <%= row.port_id %> </td>
      <td> <%= row.version %></td>
      <td> <%= row.variants %> </td>
      <td> <%= row.updated_at %> </td>
    </tr>
  <% end %>
  </table>
  
</div>
